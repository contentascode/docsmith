{"version":3,"sources":["../src/docsmith-start-old.js"],"names":["program","require","settings","spawn","path","fs","id","x","component","description","option","arguments","action","comp","parse","process","argv","console","log","exit","config","generate","metalsmith","fileExists","join","cwd","destination","metadata","formatDate","date","format","serve","watch","redirects","Object","assign","publish","baseurl","plugins","push","document_root","http_error_files","paths","reload","livereload","customHTML","validate","writeFile","JSON","stringify","err","jekyll","concat","env","stdio","filePath","statSync","isFile"],"mappings":"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","file":"docsmith-start-old.js","sourcesContent":["\n\n/**\n * Module dependencies.\n */\n\nconst program = require('commander');\nconst settings = require('./docsmith/settings').settings;\nconst spawn = require('child_process').spawn;\nconst path = require('path');\nconst fs = require('fs');\n\nconst id = x => x;\n\nlet component;\n\nprogram\n  .description('Start preview and workspace')\n  .option('-s, --serve', 'Serves', id, true)\n  .option('-w, --watch', 'Serves and watches', id, true)\n  .option('-r, --reload', 'Live reload', id, true)\n  .option('-v, --validate', 'Validate links', id, true)\n  .option('-c, --config <config>', 'Specify configuration file')\n  .option('-d, --destination <directory>', 'Specify build destination')\n  .arguments('[component] [options]')\n  .action(function(comp) {\n    component = comp;\n  })\n  .parse(process.argv);\n\nif (component) console.log('Ignoring option component', component);\nconsole.log('settings', settings);\nprocess.exit(0);\n\nlet config;\n\nif (settings.generate.metalsmith) {\n  if (program.config && fileExists(path.join(process.cwd(), program.config))) {\n    config = require(path.join(process.cwd(), program.config));\n  } else if (fileExists(path.join(process.cwd(), 'metalsmith.json'))) {\n    config = require(path.join(process.cwd(), 'metalsmith.json'));\n  } else {\n    console.log('Could not find a metalsmith configuration file.');\n    process.exit(1);\n  }\n\n  if (program.destination) {\n    config.destination = program.destination;\n  }\n\n  //  var metalsmith = spawn('metalsmith', [''], { env: process.env, stdio: \"inherit\"});\n\n  // provide a formatting function for use in templates\n  config.metadata.formatDate = function(date, format) {\n    return require('moment')(date).format(format || 'MMMM Do, YYYY');\n  };\n  // only enable live-reloading when requested\n  if (program.serve || program.watch) {\n    const redirects = Object.assign(\n      {\n        '/': settings.publish.baseurl + '/'\n      },\n      settings.publish.redirects\n    );\n\n    config.plugins.push({\n      'metalsmith-serve': {\n        document_root: '_site',\n        redirects,\n        http_error_files: {\n          '404': settings.publish.baseurl + '/404.html'\n        }\n      }\n    });\n  }\n\n  if (program.watch) {\n    const watch = {\n      'metalsmith-watch': {\n        paths: {\n          '${source}/**/*.md': true,\n          '_layouts/**': '**/*.md',\n          '_includes/**': '**/*.md'\n        }\n      }\n    };\n    if (program.reload) {\n      watch['metalsmith-watch'].livereload = 35729;\n      config.metadata.customHTML = '<script src=\"http://localhost:35729/livereload.js?snipver=1\"></script>';\n    }\n    config.plugins.push(watch);\n  }\n  // if (program.watch && program.reload) {\n  //   config.plugins.push( { 'metalsmith-watch' : { livereload: 35729 } } );\n  //   config.metadata.customHTML = '<script src=\"http://localhost:35729/livereload.js?snipver=1\"></script>';\n  // }\n  if (program.validate) {\n    config.plugins.push({ 'metalsmith-broken-link-checker': true });\n  }\n  // config.plugins.find( x => { for (k in x) { return (k == 'metalsmith-ignore') } } )['metalsmith-ignore'].push(\"metalsmith.tmp.json\");\n  // Swallow the --watch option\n  process.argv = [];\n\n  fs.writeFile('metalsmith.tmp.json', JSON.stringify(config, null, 2), 'utf8', function(err) {\n    if (err) {\n      console.log(err);\n      process.exit(1);\n    }\n    process.argv.push('/usr/local/bin/node', '/usr/local/bin/content-build', '--config', 'metalsmith.tmp.json');\n    require('metalsmith/bin/metalsmith');\n  });\n} else if (settings.generate.jekyll) {\n  config = program.config ? ['--config', program.config] : [];\n  spawn('bundle', ['exec', 'jekyll', 'build'].concat(config), { env: process.env, stdio: 'inherit' });\n}\n\nfunction fileExists(filePath) {\n  try {\n    return fs.statSync(filePath).isFile();\n  } catch (err) {\n    return false;\n  }\n}\n"]}